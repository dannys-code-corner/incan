# incan_stdlib

Standard library for Incan-generated Rust code.

This crate provides the runtime support that all Incan-compiled programs depend on. It includes traits, utilities, and helper functions that enable Incan's high-level language features to work seamlessly when compiled to Rust.

## Purpose

When you write Incan code with models, classes, and decorators, the compiler generates Rust code that leverages this standard library. Think of it as the bridge between Incan's Python-like ergonomics and Rust's performance.

## What's Inside

### Core Traits

#### `FieldInfo` - Reflection Support

Provides compile-time reflection for Incan models and classes:

```rust
pub trait FieldInfo {
    fn field_names() -> Vec<&'static str>;
    fn field_types() -> Vec<&'static str>;
}
```

**Used by**: All Incan models and classes automatically implement this via `#[derive(FieldInfo)]`

#### `ToJson` / `FromJson` - Serialization Helpers

Convenient wrappers around `serde_json` for types with `Serialize`/`Deserialize`:

```rust
pub trait ToJson: Serialize {
    fn to_json(&self) -> Result<String, Box<dyn Error>>;
    fn to_json_pretty(&self) -> Result<String, Box<dyn Error>>;
}

pub trait FromJson: for<'de> Deserialize<'de> {
    fn from_json(json: &str) -> Result<Self, Box<dyn Error>>;
}
```

**Used by**: Models with `@derive(Serialize, Deserialize)` decorators

### The Prelude

Import everything at once:

```rust
use incan_stdlib::prelude::*;
```

This brings in:

- `FieldInfo` trait
- `ToJson` / `FromJson` traits (when `json` feature enabled)

## Features

### `json` (optional)

Enables JSON serialization support. Adds dependencies on `serde` and `serde_json`.

**Enabled when**: Your Incan code uses `@derive(Serialize, Deserialize)`

## Architecture Notes

### Why a Separate Crate?

Generated Incan programs need access to these traits and utilities, but shouldn't depend on the entire compiler. This crate provides a minimal, stable API surface for compiled code.

### Relationship with `incan_derive`

- **`incan_stdlib`** (this crate) - Defines the traits (what to implement)
- **`incan_derive`** - Provides the macros to generate implementations (how to implement)

They work together:

```rust
// Generated by Incan compiler:
use incan_stdlib::prelude::*;  // Get the FieldInfo trait
use incan_derive::FieldInfo;    // Get the #[derive(FieldInfo)] macro

#[derive(Debug, Clone, FieldInfo)]
pub struct User {
    pub name: String,
    pub age: i64,
}

// Now you can call:
// User::field_names() => ["name", "age"]
```

## Version Compatibility

This crate follows the Incan compiler version. When you compile with `incan v0.1.0-alpha.1`, the generated code depends on `incan_stdlib v0.1.0`.

## License

Apache 2.0
