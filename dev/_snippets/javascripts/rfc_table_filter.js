// RFC index table filter
// - Adds client-side filtering for RFC tables generated by the docs tooling.
// - Works with MkDocs Material instant navigation (document$.subscribe).

(function () {
  function setupFilter(input) {
    if (input.dataset.rfcFilterBound === "true") return;
    input.dataset.rfcFilterBound = "true";

    const key = input.getAttribute("data-rfc-filter");
    if (!key) return;

    const tableHost = document.querySelector(`[data-rfc-table="${key}"]`);
    if (!tableHost) return;

    const table = tableHost.querySelector("table");
    if (!table) return;

    const tbody = table.querySelector("tbody");
    const rows = Array.from((tbody || table).querySelectorAll("tr"));

    function apply() {
      const q = (input.value || "").trim().toLowerCase();
      for (const tr of rows) {
        // Keep header rows visible if any slipped into the selection
        if (tr.querySelector("th")) continue;
        const hay = (tr.textContent || "").toLowerCase();
        tr.style.display = q === "" || hay.includes(q) ? "" : "none";
      }
    }

    input.addEventListener("input", apply);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        input.value = "";
        apply();
      }
    });

    apply();
  }

  function init() {
    const inputs = document.querySelectorAll('input[data-rfc-filter]');
    for (const input of inputs) setupFilter(input);
  }

  // MkDocs Material instant navigation support
  if (typeof window.document$ !== "undefined" && typeof window.document$.subscribe === "function") {
    window.document$.subscribe(init);
  } else {
    document.addEventListener("DOMContentLoaded", init);
  }
})();
